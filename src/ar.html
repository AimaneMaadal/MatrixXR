<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="./couch.ico" type="image/x-icon">
    <title>Demo</title>
    
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.0.1/model-viewer.min.js"></script>

    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <model-viewer 
      id="couch" 

      style="width: 100%; height: 92vh" 
      shadow-intensity="1"
      ar-placement="floor"
      ar-modes="webxr scene-viewer quick-look"
      camera-controls
      ar
      ></model-viewer>
      
    </model-viewer>
    <script type="module">

      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get('id')
      const mat = urlParams.get('mat')

      console.log(id+" "+mat);

      const modelViewerTexture1 = document.querySelector("model-viewer#couch");

      modelViewerTexture1.src = 'models/AR/'+id+'/'+mat+'.glb';

      modelViewerTexture1.addEventListener("load", () => {
        const material = modelViewerTexture1.model.materials[0];
        const createAndApplyTexture = async (channel, event) => {
          const texture = await modelViewerTexture1.createTexture(event.target.value);
          if (channel.includes('base') || channel.includes('metallic')) {
            material.pbrMetallicRoughness[channel].setTexture(texture);
          } else {
            material[channel].setTexture(texture);
          }
        }
        createAndApplyTexture('occlusionTexture', {target: {value: 'textures/fabric003/Substance_Graph_AmbientOcclusion.webp'}});
        createAndApplyTexture('emissiveTexture', {target: {value: 'textures/fabric003/Substance_Graph_Height.webp'}});
      });  
      
    </script>
</html>